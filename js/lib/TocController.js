'use strict';define(['Common','lodash','jquery'],function(Common,_,$){return function TocController($toc,index){var CLASS_OPEN='expanded';var CLASS_CLOSED='collapsed';var common=Common(index);var $nav=$('nav[role=toc]');common.initializeMain();addTocControllers();loadFullToc();function loadFullToc(){initializeToc($toc);$('nav[role=toc]').html($toc.html());addTocControllers();function initializeToc($dummy){var $current=void 0;$dummy.find('a').each(function(){var $a=$(this);var abs=new URI($a.attr('href')).absoluteTo(index).href();$a.attr('href',abs);if(abs===window.location.href){$current=$a;}});if(!$current||!$current.length){var target=new URI(window.location.href);if(target.fragment().length>0){$current=$dummy.find('a[href="'+target.fragment('')+'"]:first');}}if(!$current||!$current.length){if(_.endsWith(window.location.href,'/')){var _target=window.location.href+'index.html';$current=$dummy.find('a[href="'+_target+'"]:first');}else if(_.endsWith(window.location.href,'/index')){var _target2=window.location.href.substring(0,window.location.href.length-10);$current=$dummy.find('a[href="'+_target2+'"]:first');}}if($current){$current.parent('li').addClass('active');$dummy.find('li').each(function(){toggleNode($(this));});$current.parents('li').each(function(){toggleNode($(this));});}}}function toggleNode($node){if($node.hasClass(CLASS_CLOSED)){$node.addClass(CLASS_OPEN).removeClass(CLASS_CLOSED);}else{$node.addClass(CLASS_CLOSED).removeClass(CLASS_OPEN);}}function addTocControllers(){$nav.find('li').each(function(){var $li=$(this);if(!$li.hasClass(CLASS_OPEN)){$li.addClass(CLASS_OPEN);}if($li.children('ul').length){$('<span class="controller"></span>').click(toggleHandler).prependTo($li);}$li.children('a[href]').filter(common.isLocal).click(navigateHandler);});function toggleHandler(event){var $target=$(event.target);var $node=$target.parent('li');toggleNode($node);}function navigateHandler(event){event.preventDefault();event.stopPropagation();var $target=$(event.target);var href=$target.get(0).href;common.loadMain(href,$target);}}};});