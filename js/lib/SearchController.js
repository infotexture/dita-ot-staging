'use strict';define(['lodash','jquery','jquery','bootstrap'],function(_,$,jQuery){return function SearchController($toc){var titles=getTitles($toc);var $searchInput=$('#tocSearchInput');var $modal=$('#tocSearch');var isModelActive=false;$modal.modal({show:false}).on('shown.bs.modal',onShow).on('hidden.bs.modal',onHide);$searchInput.keyup(onType);$(document).keypress(openSearch);function onType(event){var value=$searchInput.val();var query=buildQuery(value);var results=_(titles).filter(function(title){return query.test(title)}).map(function(title){return '<p><a>'+title+'</a></p>'}).value();$('.modal-body').html(results);function buildQuery(value){var query=_(value).map(function(c){switch(c){case '.':case '\\':return '\\'+c;default:return c;}}).join('.*?');console.log(query);return new RegExp(query,'gi')}}function onShow(){isModelActive=true;$searchInput.val('').focus()}function onHide(){isModelActive=false;$('.modal-body').empty()}function openSearch(event){var key=event.which;if(!isModelActive&&key===116){$modal.modal('show')}}function getTitles($toc){return $toc.find('li > a').map(function(){return $.trim($(this).text())}).toArray()}}});